<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="{{ url_for('static', filename='js/jquery-3.4.1.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/app.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-FxF76yBO1ruRcN+a/7wRiIVBHQhDZrN9QW+nG3q/72yfJ7atj8nOdWV7wjqNgAK2xV7iZ8m/b5V5m5mOhL0n1w==" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans:300|Open+Sans:300|Oxygen|Material+Icons"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-hK9v5+LMq3aOZ5Q5IR5RyKv5oW/S/17xntEa1l9k5HXr8Wq5o5N5ueHgI02mlPn2xp62FtC1JtjcA9XpI8tjLg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    $(document).ready(function() {
  // Send AJAX requests to the Flask server as the user types in the input field
  $('#search-input').on('input', function() {
    var data = $(this).val();
    $.ajax({
      type: 'POST',
      url: '/speldetect',
      data: { data: data },
      success: function(suggestions) {
        // Update the suggestion list in real-time as new spelling suggestions arrive
        $('#suggestion-list').empty();
        for (var word in suggestions) {
          if (suggestions.hasOwnProperty(word)) {
            var suggestionList = $('<ul>');
            for (var i = 0; i < suggestions[word].length; i++) {
              var suggestion = $('<li>').text(suggestions[word][i]).click(function(){
                // Replace the input word with the clicked suggestion
                var replacement = $(this).text();
                data = data.replace(word, replacement);
                $('#search-input').val(data);
                // Update the suggestions for the new input
                $('#search-input').trigger('input');
              });
              suggestionList.append(suggestion);
            }
            var suggestionListItem = $('<li>').text(word + ': ').append(suggestionList);
            $('#suggestion-list').append(suggestionListItem);
          }
        }
      }
    });
  });
});

  </script>
    	<style>
		body {
			font-family: Arial, sans-serif;
			background-color: #f2f2f2;
		}

		.container {
			max-width: 500px;
			margin: 0 auto;
			padding: 20px;
			background-color: #fff;
			border-radius: 5px;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
		}

		h1 {
			text-align: center;
			color: #333;
		}

		form {
			display: flex;
			flex-direction: column;
		}

		input[type="file"] {
			margin-bottom: 10px;
		}

		input[type="submit"] {
			background-color: #4CAF50;
			color: #fff;
			border: none;
			padding: 10px;
			border-radius: 5px;
			cursor: pointer;
		}

		input[type="submit"]:hover {
			background-color: #3e8e41;
		}

	</style>
</head>


<body>
<!--    <h2 > Advance NLP Application - "Moral of the Story" </h2>-->
    <h2> Let's Play with Texts and Grab the Facts  <a href="/logout">
      <button style="background-color: red; color: white; border: none; padding: 4px; border-radius: 5px; float: right; ">
        <i class="fas fa-power-off" style="margin-right: 5px;"></i> Logout</button>
    </a> </h2>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="margin-top: -8px;">
      <a class="navbar-brand" href="/shop">My App</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
            <li class="nav-item">
            <a class="nav-link" href="/splitpdf">Split Pdf</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/shop/about">About Us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/shop/contact">Contact Us</a>
          </li>
        </ul>
          <form class="form-inline my-2 my-lg-0">
              <div class="input-group">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" id="search-input">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary" type="button" id="speak-btn"><i class="fas fa-microphone"></i>üéôÔ∏è </button>
                </div>
              </div>
              <button class="btn btn-outline-success my-2 my-sm-0 mx-2"  type="submit">Search</button>
          </form>
      </div>
    </nav>
    <ul id="suggestion-list"></ul>
    <div class="">
        <div class="row">
            <div class="col-sm-1"></div>

            <div class="col-sm-10">
                <div style="background-color: #FFFF00; padding: 10px;">
                <marquee behavior="scroll" direction="left">Wish you have a Good Day  |  Rajasthan IT Day Hackathon 2023</marquee>
                </div>
                <div class="overlay">
                    <div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div>
                </div>
                <div class="container my-3">
                    <h1>Choose PDF/TXT File</h1>
                    <form method="post" action="/upload_file" enctype="multipart/form-data">
                        <input type="file" name="file" accept=".pdf,.txt,.mp3">
                        <input type="submit" value="Upload">
                    </form>
                </div>
                <div class="speak-button">
                    <button onclick="toggleSpeechRecognition()"> üéôÔ∏èSpeak</button>
                </div>
                <h4> Input Text </h4>
                <textarea class="form-control txt_input" id="txt_input"> {{ text }} </textarea>
                <h4> Parameters </h4>
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label for="input_model">Model</label>
                        <select id="input_model" class="form-control">
                            <option selected>FAST-Summary</option>
                            <option>BART</option>
                            <option>TEXT-RANK</option>
                        </select>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="max_words" id="label_max_words"># words in summary: 50</label>
                        <input type="range" class="custom-range" min="50" max="200" value="50" step="10" id="max_words">
                    </div>

                    <div class="form-group col-md-3">
                        <label for="num_beams" id="label_num_beams"># beam search: 4</label>
                        <input type="range" class="custom-range" min="1" max="20" value="4" step="1" id="num_beams">
                    </div>

                    <div class="form-group col-md-3">
                        <button type="button" class="btn btn-primary btn-lg btn-block"  id="btn-process">Generate</button>
                        <button type="button" class="btn btn-secondary btn-lg btn-block" id="btn-clear" style="background-color: #f80707; color: #fff;">Clear</button>
                    </div>
                </div>

                <h4> Summary </h4>
                <div class="input-group mb-3">
                    <textarea class="form-control txt_summary" id="input_summary" readonly> </textarea>
                    <style>
                    .round-btn {
                      border-radius: 50%;
                    }
                    </style>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="btn-copy" title="Copy summary to clipboard" style="background-color: #4CAF50; color: #fff;">üÖ≤üÖæüÖøüÜà</button>
                        <a class="btn btn-outline-secondary" id="btn-download" href="#" download="summary.txt" title="Download summary" style="background-color: #4CAF50; color: #fff;">‚¨áDownload‚¨á
                        <p>‚¨á</p></a>
                    </div>

                </div>
                <h4> Listen </h4>
                <button class="btn btn-outline-secondary round-btn" type="button" id="btn-speak" title="Speak summary" style="background-color: #4CAF50; color: #fff;"><span class="material-icons">volume_up</span><i class="fa fa-copy"></button>
                <audio id="audio_player" controls>
                    <source id="audio_src" src="" type="audio/mpeg">
                </audio>
                <style>
                    #btn-download {
                      margin-left: 10px;
                    }
                </style>
            </div>
            <div class="col-sm-1"></div>
        </div>
    </div>
        <footer class="text-center text-white my=2" style="background-color: #d4d2d2;">
        <!-- Copyright -->
        <div class="text-center text-light p-3" style="background-color: rgba(3, 36, 67, 0.504);">
            ¬© 2022 Copyright:
            <a class="text-light" href="https://www.linkedin.com/in/danish-alam-838181162/">AlamDanish Pvt Ltd</a>
        </div>

        <!-- Copyright -->
    </footer>
<script>
    // Add event listener to clear button
    document.getElementById("btn-clear").addEventListener("click", function() {
        document.getElementById("txt_input").value = "";
        document.getElementById("input_summary").value = "";
    });
    const btnCopy = document.getElementById("btn-copy");
    const txtSummary = document.getElementById("input_summary");

    btnCopy.addEventListener("click", function() {
        txtSummary.select();
        document.execCommand("copy");
    });

    // get the "Speak" button element
    const speakButton = document.querySelector('#btn-speak');

    // add event listener to Speak button
    speakButton.addEventListener("click", function() {
        // retrieve summary text from textarea
        var summary_text = document.getElementById("input_summary").value;
        // send AJAX request to Flask server to trigger /speak route
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/speak");
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.responseType = "blob";  // set response type to blob
        xhr.onload = function() {
            // create object URL from blob and set as audio player source
            var audioBlob = xhr.response;
            var audioUrl = URL.createObjectURL(audioBlob);
            var audioSrc = document.getElementById("audio_src");
            audioSrc.setAttribute("src", audioUrl);
            // trigger audio player to start playing
            var audioPlayer = document.getElementById("audio_player");
            audioPlayer.load();
            audioPlayer.play();
        };
        xhr.send("url=" + encodeURIComponent(window.location.href) + "&summary_text=" + encodeURIComponent(summary_text));
    });

var downloadBtn = document.querySelector('#btn-download');
var summaryBox = document.querySelector('#input_summary');

downloadBtn.addEventListener('click', function(e) {
    var text = summaryBox.value;
    if (text) {
        var fileType = prompt('Enter file format (txt/pdf):');
        if (fileType === 'txt') {
            var data = new Blob([text], { type: 'text/plain' });
            var url = window.URL.createObjectURL(data);
            e.target.href = url;
            e.target.download = 'summary.txt';
        } else if (fileType === 'pdf') {
            fetch('/download', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'summary=' + text + '&format=pdf'
            })
            .then(function(response) {
                return response.blob();
            })
            .then(function(blob) {
                var url = window.URL.createObjectURL(blob);
                e.target.href = url;
                e.target.download = 'summary.pdf';
            });
        } else {
            alert('Invalid file format!');
        }
    } else {
        e.preventDefault();
        downloadBtn.classList.add('disabled');
        downloadBtn.setAttribute('title', 'Summary box is empty');
        downloadBtn.innerHTML = '<i class="fa fa-ban"></i>';
    }
});

downloadBtn.addEventListener('mouseover', function(e) {
    if (summaryBox.value === '') {
        downloadBtn.classList.add('disabled');
        downloadBtn.setAttribute('title', 'Summary box is empty');
        downloadBtn.innerHTML = '<i class="fa fa-circle-o"></i>';
    }
});

downloadBtn.addEventListener('mouseout', function(e) {
    downloadBtn.classList.remove('disabled');
    downloadBtn.removeAttribute('title');
    downloadBtn.innerHTML = 'Download';
});


// initialize SpeechRecognition object
    const recognition = new webkitSpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'en-US';

    // add event listener to detect when speech is recognized
    recognition.onresult = function(event) {
        let interimTranscript = '';
        let finalTranscript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
            let transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
                finalTranscript += transcript;
            } else {
                interimTranscript += transcript;
            }
        }
        document.getElementById("txt_input").value = finalTranscript;
    }

    let isRecording = false;
    function toggleSpeechRecognition() {
        if (!isRecording) {
            recognition.start();
            isRecording = true;
            document.getElementById("speak-button").innerHTML = "Stopüõë";
        } else {
            recognition.stop();
            isRecording = false;
            document.getElementById("speak-button").innerHTML = "üéôÔ∏èSpeak";
        }
    }


<!-- Spel prediction-->

const searchForm = document.querySelector('form');
const searchInput = document.querySelector('#search-input');
const speakBtn = document.querySelector('#speak-btn');

speakBtn.addEventListener('click', () => {
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'en-US';
  recognition.start();
  recognition.onresult = function(event) {
    const speechResult = event.results[0][0].transcript;
    searchInput.value = speechResult;
  }
});

searchForm.addEventListener('submit', (event) => {
  event.preventDefault();
  const searchText = searchInput.value;
  if (searchText) {
    const searchUrl = `https://www.google.com/search?q=${searchText}`;
    window.location.href = searchUrl;
  }
});
</script>
</body>

</html>
